name: auravibes_workspace
publish_to: none
environment:
  sdk: ^3.10.0

workspace:
  - apps/auravibes_app
  - packages/auravibes_ui
  - widgetbook

dev_dependencies:
  dependency_validator: ^5.0.3
  import_sorter: ^4.6.0
  melos: ^7.3.0
  very_good_analysis: ^10.0.0

melos:
  name: auravibes_workspace

  categories:
    app:
      - "apps/**"
    packages:
      - "packages/**"
  command:
      bootstrap:
        usePubspecOverrides: true
        runPubGetInParallel: false
        environment:
          sdk: ^3.10.0
  scripts:
    analyze:
      run: dart analyze

    analyze:fix:
      run: dart fix --apply

    format:check:
      run: dart format --line-length 80 -o none --set-exit-if-changed .
      description: Check code formating

    format:fix:
      run: dart format --line-length 80 .
      description: Fix code formatting

    # Testing Scripts
    test:
      exec: flutter test --coverage --reporter=expanded
      packageFilters:
        dirExists: test
      description: Run tests for all packages with coverage

    # Code Generation Scripts
    generate:
      exec: dart run build_runner build --delete-conflicting-outputs
      description: Run code generation for all packages
      packageFilters:
        dependsOn: build_runner

    generate:watch:
      exec: dart run build_runner watch --delete-conflicting-outputs
      description: Run code generation in watch mode
      packageFilters:
        dependsOn: build_runner
      concurrency: 10
    
    localization:
      # Run build_runner and format only the generated files
      exec: dart pub run easy_localization:generate -S assets/i18n -f keys -O lib/i18n -o locale_keys.dart --skip-unnecessary-keys && dart format lib/i18n/locale_keys.dart
      concurrency: 1
      orderDependents: true
      failFast: true
      packageFilters:
        dependsOn:
          - easy_localization

    clean:
      run: melos exec -- "flutter clean"
      description: Clean all packages

    # Validation Pipeline (for CI)
    validate:
      run: |
        melos analyze &&
        melos run format &&
        melos run test &&
        melos run build
      description: Full validation pipeline for CI/CD

    validate:quick:
      run: |
        melos analyze &&
        melos run format
      description: Quick validation for development

    # Development Scripts
    outdated:
      run: flutter pub outdated
      description: Check for outdated dependencies

    upgrade:
      run: flutter pub upgrade
      description: Upgrade dependencies

    # Maintenance Scripts
    reset:
      description: Reset and regenerate all packages
      steps:
        - melos clean
        - melos bootstrap
        -  melos run generate
    
    generate:flavors:
      exec: dart pub run flutter_flavorizr -f
      concurrency: 1
      orderDependents: true
      failFast: true
      packageFilters:
        dependsOn:
          - flutter_flavorizr

    generate:icons:
      exec: dart pub run flutter_launcher_icons
      concurrency: 1
      orderDependents: true
      failFast: true
      packageFilters:
        dependsOn:
          - flutter_launcher_icons


